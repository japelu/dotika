<!DOCTYPE html>

<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#1a4d4d">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Dotika">
  <title>Dotika - Smart Home</title>

  <!-- PWA Manifest -->

  <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkRvdGlrYSBTbWFydCBIb21lIiwKICAic2hvcnRfbmFtZSI6ICJEb3Rpa2EiLAogICJkZXNjcmlwdGlvbiI6ICJUdSBob2dhciBpbnRlbGlnZW50ZSIsCiAgInN0YXJ0X3VybCI6ICIvIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjMWE0ZDRkIiwKICAidGhlbWVfY29sb3IiOiAiIzFhNGQ0ZCIsCiAgIm9yaWVudGF0aW9uIjogInBvcnRyYWl0IiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sLCUzQ3N2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAxMDAgMTAwJyUzRSUzQ3JlY3Qgd2lkdGg9JzEwMCcgaGVpZ2h0PScxMDAnIGZpbGw9JyUyMzFhNGQ0ZCcvJTNFJTNDdGV4dCB4PSc1MCUyNScgeT0nNTUlMjUnIGZvbnQtc2l6ZT0nNDAnIGZpbGw9JyUyM2Y1ZjVkYycgZm9udC13ZWlnaHQ9J2JvbGQnIGZvbnQtZmFtaWx5PSdzYW5zLXNlcmlmJyB0ZXh0LWFuY2hvcj0nbWlkZGxlJyUzRUQlM0MvdGV4dCUzRSUzQy9zdmclM0UiLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9LAogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbCwlM0NzdmcgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB2aWV3Qm94PScwIDAgMTAwIDEwMCclM0UlM0NyZWN0IHdpZHRoPScxMDAnIGhlaWdodD0nMTAwJyBmaWxsPSclMjMxYTRkNGQnLyUzRSUzQ3RleHQgeD0nNTAlMjUnIHk9JzU1JTI1JyBmb250LXNpemU9JzQwJyBmaWxsPSclMjNmNWY1ZGMnIGZvbnQtd2VpZ2h0PSdib2xkJyBmb250LWZhbWlseT0nc2Fucy1zZXJpZicgdGV4dC1hbmNob3I9J21pZGRsZSclM0VEJTNDL3RleHQlM0UlM0Mvc3ZnJTNFIiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0KfQ==">

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    * {
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
    }
    
    body {
      overscroll-behavior: none;
      background: #1a4d4d;
    }
    
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-track {
      background: rgba(245, 245, 220, 0.1);
      border-radius: 3px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: rgba(245, 245, 220, 0.3);
      border-radius: 3px;
    }
  </style>

</head>
<body>
  <div id="app"></div>

  <script type="module">
    import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0';
    import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
    
    const icons = {
      Lightbulb: () => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
        React.createElement('path', { d: "M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5" }),
        React.createElement('path', { d: "M9 18h6" }),
        React.createElement('path', { d: "M10 22h4" })
      ),
      Power: () => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
        React.createElement('path', { d: "M12 2v10" }),
        React.createElement('path', { d: "M18.4 6.6a9 9 0 1 1-12.77.04" })
      ),
      Wind: () => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
        React.createElement('path', { d: "M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2" }),
        React.createElement('path', { d: "M9.6 4.6A2 2 0 1 1 11 8H2" }),
        React.createElement('path', { d: "M12.6 19.4A2 2 0 1 0 14 16H2" })
      ),
      Thermometer: () => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
        React.createElement('path', { d: "M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z" })
      ),
      Zap: () => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
        React.createElement('path', { d: "M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z" })
      ),
      Home: () => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
        React.createElement('path', { d: "m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" }),
        React.createElement('polyline', { points: "9 22 9 12 15 12 15 22" })
      ),
      Settings: () => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
        React.createElement('path', { d: "M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" }),
        React.createElement('circle', { cx: "12", cy: "12", r: "3" })
      ),
      RefreshCw: () => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
        React.createElement('path', { d: "M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" }),
        React.createElement('path', { d: "M21 3v5h-5" }),
        React.createElement('path', { d: "M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" }),
        React.createElement('path', { d: "M8 16H3v5" })
      ),
      Sun: () => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
        React.createElement('circle', { cx: "12", cy: "12", r: "4" }),
        React.createElement('path', { d: "M12 2v2" }),
        React.createElement('path', { d: "M12 20v2" }),
        React.createElement('path', { d: "m4.93 4.93 1.41 1.41" }),
        React.createElement('path', { d: "m17.66 17.66 1.41 1.41" }),
        React.createElement('path', { d: "M2 12h2" }),
        React.createElement('path', { d: "M20 12h2" }),
        React.createElement('path', { d: "m6.34 17.66-1.41 1.41" }),
        React.createElement('path', { d: "m19.07 4.93-1.41 1.41" })
      ),
      Moon: () => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
        React.createElement('path', { d: "M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" })
      ),
      Eye: () => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
        React.createElement('path', { d: "M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" }),
        React.createElement('circle', { cx: "12", cy: "12", r: "3" })
      ),
      EyeOff: () => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
        React.createElement('path', { d: "m15 18-.722-3.25" }),
        React.createElement('path', { d: "M2 8a10.645 10.645 0 0 0 20 0" }),
        React.createElement('path', { d: "m20 15-1.726-2.05" }),
        React.createElement('path', { d: "m4 15 1.726-2.05" }),
        React.createElement('path', { d: "m9 18 .722-3.25" })
      ),
      AlertCircle: () => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
        React.createElement('circle', { cx: "12", cy: "12", r: "10" }),
        React.createElement('line', { x1: "12", x2: "12", y1: "8", y2: "12" }),
        React.createElement('line', { x1: "12", x2: "12.01", y1: "16", y2: "16" })
      )
    };

    function DotikaApp() {
      const [isConfigured, setIsConfigured] = useState(false);
      const [url, setUrl] = useState('');
      const [token, setToken] = useState('');
      const [entities, setEntities] = useState([]);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState('');
      const [darkMode, setDarkMode] = useState(true);
      const [showConfig, setShowConfig] = useState(false);
      const [showToken, setShowToken] = useState(false);
      const [diagnostics, setDiagnostics] = useState([]);

      useEffect(() => {
        const savedUrl = localStorage.getItem('dotika_url');
        const savedToken = localStorage.getItem('dotika_token');
        if (savedUrl && savedToken) {
          setUrl(savedUrl);
          setToken(savedToken);
          setIsConfigured(true);
          fetchEntities(savedUrl, savedToken);
        }
        
        // Register service worker
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.register(createServiceWorker()).catch(err => {
            console.log('SW registration failed:', err);
          });
        }
      }, []);

      const createServiceWorker = () => {
        const swCode = `
          self.addEventListener('install', (e) => {
            self.skipWaiting();
          });
          
          self.addEventListener('activate', (e) => {
            self.clients.claim();
          });
          
          self.addEventListener('fetch', (e) => {
            e.respondWith(fetch(e.request));
          });
        `;
        const blob = new Blob([swCode], { type: 'application/javascript' });
        return URL.createObjectURL(blob);
      };

      const addDiagnostic = (message, type = 'info') => {
        const timestamp = new Date().toLocaleTimeString();
        setDiagnostics(prev => [...prev, { message, type, timestamp }]);
      };

      const fetchEntities = async (haUrl, haToken) => {
        setLoading(true);
        setError('');
        setDiagnostics([]);
        
        try {
          addDiagnostic(`🔌 Conectando a: ${haUrl}`, 'info');
          
          const response = await fetch(`${haUrl}/api/states`, {
            headers: {
              'Authorization': `Bearer ${haToken}`,
              'Content-Type': 'application/json',
            },
            mode: 'cors'
          });
          
          addDiagnostic(`📡 Respuesta: HTTP ${response.status}`, response.ok ? 'success' : 'error');
          
          if (!response.ok) {
            const errorText = await response.text();
            addDiagnostic(`❌ Error: ${errorText || 'Sin detalles'}`, 'error');
            throw new Error(`Error ${response.status}`);
          }
          
          const data = await response.json();
          addDiagnostic(`✅ ${data.length} dispositivos encontrados`, 'success');
          setEntities(data);
        } catch (err) {
          if (err.message.includes('Failed to fetch') || err.message.includes('Load failed')) {
            addDiagnostic(`❌ Error de conexión`, 'error');
            addDiagnostic(`💡 Verifica:`, 'info');
            addDiagnostic(`   • El servidor está encendido`, 'info');
            addDiagnostic(`   • La URL es correcta`, 'info');
            addDiagnostic(`   • CORS configurado en Home Assistant`, 'info');
            setError('No se puede conectar. Revisa diagnóstico.');
          } else {
            addDiagnostic(`❌ ${err.message}`, 'error');
            setError(err.message);
          }
        } finally {
          setLoading(false);
        }
      };

      const saveConfig = () => {
        if (!url || !token) {
          setError('Completa todos los campos');
          return;
        }
        localStorage.setItem('dotika_url', url);
        localStorage.setItem('dotika_token', token);
        setIsConfigured(true);
        setShowConfig(false);
        fetchEntities(url, token);
      };

      const toggleEntity = async (entityId, currentState) => {
        const domain = entityId.split('.')[0];
        const service = currentState === 'on' ? 'turn_off' : 'turn_on';
        
        try {
          await fetch(`${url}/api/services/${domain}/${service}`, {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${token}`,
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ entity_id: entityId }),
          });
          
          setTimeout(() => fetchEntities(url, token), 300);
        } catch (err) {
          setError('Error al controlar dispositivo');
        }
      };

      const getEntityIcon = (entity) => {
        const domain = entity.entity_id.split('.')[0];
        const isOn = entity.state === 'on';
        const className = `${isOn ? 'text-yellow-300' : 'text-gray-500'}`;
        
        switch (domain) {
          case 'light': return React.createElement(icons.Lightbulb);
          case 'switch': return React.createElement(icons.Power);
          case 'fan': return React.createElement(icons.Wind);
          case 'climate': return React.createElement(icons.Thermometer);
          case 'sensor': return React.createElement(icons.Zap);
          default: return React.createElement(icons.Home);
        }
      };

      const isControllable = (entity) => {
        const domain = entity.entity_id.split('.')[0];
        return ['light', 'switch', 'fan', 'cover'].includes(domain);
      };

      const groupEntitiesByDomain = () => {
        const domains = {
          'Iluminación': [],
          'Enchufes': [],
          'Clima': [],
          'Sensores': [],
          'Otros': []
        };
        
        entities.forEach(entity => {
          const domain = entity.entity_id.split('.')[0];
          switch (domain) {
            case 'light': domains['Iluminación'].push(entity); break;
            case 'switch': domains['Enchufes'].push(entity); break;
            case 'climate':
            case 'fan': domains['Clima'].push(entity); break;
            case 'sensor':
            case 'binary_sensor': domains['Sensores'].push(entity); break;
            default: domains['Otros'].push(entity);
          }
        });
        
        return Object.entries(domains).filter(([, items]) => items.length > 0);
      };

      if (!isConfigured || showConfig) {
        return React.createElement('div', { className: 'min-h-screen bg-[#1a4d4d]' },
          React.createElement('div', { className: 'container mx-auto px-4 py-12 max-w-md' },
            React.createElement('div', { className: 'text-center mb-12' },
              React.createElement('div', { className: 'mb-8' },
                React.createElement('svg', { viewBox: '0 0 800 200', className: 'w-64 mx-auto' },
                  React.createElement('text', {
                    x: '50%',
                    y: '50%',
                    dominantBaseline: 'middle',
                    textAnchor: 'middle',
                    fill: '#f5f5dc',
                    style: { fontSize: '120px', fontWeight: '700', fontFamily: 'system-ui, sans-serif', letterSpacing: '0.05em' }
                  }, 'DOTIKA')
                )
              ),
              React.createElement('p', { className: 'text-lg text-[#f5f5dc]/70' }, 'Tu hogar inteligente')
            ),
            React.createElement('div', { className: 'bg-[#1a4d4d]/60 backdrop-blur-sm p-8 rounded-2xl border border-[#f5f5dc]/20' },
              React.createElement('h2', { className: 'text-xl font-semibold mb-6 text-[#f5f5dc]' }, 'Configuración'),
              React.createElement('div', { className: 'mb-6' },
                React.createElement('label', { className: 'block mb-2 text-sm font-medium text-[#f5f5dc]/80' }, 'Servidor'),
                React.createElement('input', {
                  type: 'text',
                  value: url,
                  onChange: (e) => setUrl(e.target.value),
                  placeholder: 'http://servidor.dotika.uy:8123',
                  className: 'w-full p-4 rounded-xl border border-[#f5f5dc]/20 bg-[#0d3333] text-[#f5f5dc] placeholder-[#f5f5dc]/40 focus:outline-none focus:border-[#f5f5dc]/50'
                })
              ),
              React.createElement('div', { className: 'mb-6' },
                React.createElement('label', { className: 'block mb-2 text-sm font-medium text-[#f5f5dc]/80' }, 'Token'),
                React.createElement('div', { className: 'relative' },
                  React.createElement('input', {
                    type: showToken ? 'text' : 'password',
                    value: token,
                    onChange: (e) => setToken(e.target.value),
                    placeholder: 'Ingresa tu token',
                    className: 'w-full p-4 pr-12 rounded-xl border border-[#f5f5dc]/20 bg-[#0d3333] text-[#f5f5dc] placeholder-[#f5f5dc]/40 focus:outline-none focus:border-[#f5f5dc]/50'
                  }),
                  React.createElement('button', {
                    type: 'button',
                    onClick: () => setShowToken(!showToken),
                    className: 'absolute right-4 top-1/2 -translate-y-1/2 text-[#f5f5dc]/50'
                  }, showToken ? React.createElement(icons.EyeOff) : React.createElement(icons.Eye))
                )
              ),
              error && React.createElement('div', { className: 'mb-6 p-4 bg-red-900/30 border border-red-500/50 rounded-xl flex items-start gap-3' },
                React.createElement(icons.AlertCircle),
                React.createElement('span', { className: 'text-sm text-red-300' }, error)
              ),
              diagnostics.length > 0 && React.createElement('div', { className: 'mb-6 p-4 bg-[#0d3333] border border-[#f5f5dc]/20 rounded-xl max-h-64 overflow-y-auto custom-scrollbar' },
                React.createElement('h3', { className: 'text-sm font-semibold text-[#f5f5dc] mb-2' }, '📋 Diagnóstico:'),
                React.createElement('div', { className: 'space-y-1' },
                  diagnostics.map((diag, idx) =>
                    React.createElement('div', {
                      key: idx,
                      className: `text-xs font-mono ${
                        diag.type === 'error' ? 'text-red-300' :
                        diag.type === 'success' ? 'text-green-300' :
                        'text-[#f5f5dc]/70'
                      }`
                    },
                      React.createElement('span', { className: 'text-[#f5f5dc]/50' }, `[${diag.timestamp}] `),
                      diag.message
                    )
                  )
                )
              ),
              React.createElement('button', {
                onClick: saveConfig,
                disabled: loading,
                className: 'w-full bg-[#f5f5dc] hover:bg-[#e5e5cc] text-[#1a4d4d] font-bold py-4 rounded-xl transition-all disabled:opacity-50'
              }, loading ? 'Conectando...' : 'Acceder'),
              isConfigured && React.createElement('button', {
                onClick: () => setShowConfig(false),
                className: 'w-full mt-3 text-[#f5f5dc]/60 hover:text-[#f5f5dc]/80 py-3'
              }, 'Cancelar')
            ),
            React.createElement('p', { className: 'text-center mt-8 text-sm text-[#f5f5dc]/40' }, 'Powered by Dotika © 2025')
          )
        );
      }

      const groupedEntities = groupEntitiesByDomain();

      return React.createElement('div', { className: 'min-h-screen bg-[#1a4d4d]' },
        React.createElement('div', { className: 'sticky top-0 z-10 bg-[#0d3333]/95 backdrop-blur-sm border-b border-[#f5f5dc]/10 shadow-lg' },
          React.createElement('div', { className: 'container mx-auto px-4 py-4' },
            React.createElement('div', { className: 'flex items-center justify-between' },
              React.createElement('div', { className: 'flex items-center gap-3' },
                React.createElement('svg', { viewBox: '0 0 800 200', className: 'w-32 h-10' },
                  React.createElement('text', {
                    x: '50%',
                    y: '50%',
                    dominantBaseline: 'middle',
                    textAnchor: 'middle',
                    fill: '#f5f5dc',
                    style: { fontSize: '120px', fontWeight: '700', fontFamily: 'system-ui, sans-serif', letterSpacing: '0.05em' }
                  }, 'DOTIKA')
                ),
                React.createElement('div', { className: 'ml-2 text-xs text-[#f5f5dc]/60' }, `${entities.length} dispositivos`)
              ),
              React.createElement('div', { className: 'flex items-center gap-2' },
                React.createElement('button', {
                  onClick: () => fetchEntities(url, token),
                  disabled: loading,
                  className: 'p-2.5 rounded-xl hover:bg-[#f5f5dc]/10 transition-all text-[#f5f5dc]'
                }, React.createElement(icons.RefreshCw, { className: loading ? 'animate-spin' : '' })),
                React.createElement('button', {
                  onClick: () => setDarkMode(!darkMode),
                  className: 'p-2.5 rounded-xl hover:bg-[#f5f5dc]/10 transition-all text-[#f5f5dc]'
                }, darkMode ? React.createElement(icons.Sun) : React.createElement(icons.Moon)),
                React.createElement('button', {
                  onClick: () => setShowConfig(true),
                  className: 'p-2.5 rounded-xl hover:bg-[#f5f5dc]/10 transition-all text-[#f5f5dc]'
                }, React.createElement(icons.Settings))
              )
            )
          )
        ),
        React.createElement('div', { className: 'container mx-auto px-4 py-6 max-w-7xl' },
          error && React.createElement('div', { className: 'mb-6 p-4 bg-red-900/30 border border-red-500/50 rounded-xl flex items-center gap-3' },
            React.createElement(icons.AlertCircle),
            React.createElement('span', { className: 'text-red-300' }, error)
          ),
          loading && entities.length === 0 ? React.createElement('div', { className: 'text-center py-20' },
            React.createElement(icons.RefreshCw, { className: 'w-12 h-12 animate-spin mx-auto mb-4 text-[#f5f5dc]/60' }),
            React.createElement('p', { className: 'text-[#f5f5dc]/70' }, 'Cargando...')
          ) : entities.length === 0 ? React.createElement('div', { className: 'text-center py-20' },
            React.createElement(icons.AlertCircle, { className: 'w-16 h-16 mx-auto mb-4 text-[#f5f5dc]/40' }),
            React.createElement('p', { className: 'text-lg text-[#f5f5dc]/70' }, 'No hay dispositivos'),
            React.createElement('p', { className: 'text-sm mt-2 text-[#f5f5dc]/50' }, 'Verifica tu conexión')
          ) : groupedEntities.map(([category, categoryEntities]) =>
            React.createElement('div', { key: category, className: 'mb-8' },
              React.createElement('h2', { className: 'text-xl font-bold mb-4 px-2 text-[#f5f5dc]' }, category),
              React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4' },
                categoryEntities.map(entity =>
                  React.createElement('div', {
                    key: entity.entity_id,
                    className: 'p-5 rounded-2xl bg-[#0d3333]/60 backdrop-blur-sm border border-[#f5f5dc]/10 hover:border-[#f5f5dc]/30 transition-all'
                  },
                    React.createElement('div', { className: 'flex items-start justify-between mb-4' },
                      React.createElement('div', { className: 'flex items-center gap-3 flex-1 min-w-0' },
                        React.createElement('div', { className: 'p-2.5 rounded-xl bg-[#1a4d4d]/80' },
                          getEntityIcon(entity)
                        ),
                        React.createElement('div', { className: 'flex-1 min-w-0' },
                          React.createElement('h3', { className: 'font-semibold truncate text-[#f5f5dc]' },
                            entity.attributes.friendly_name || entity.entity_id
                          ),
                          React.createElement('p', { className: 'text-xs text-[#f5f5dc]/50' },
                            entity.entity_id.split('.')[0].toUpperCase()
                          )
                        )
                      )
                    ),
                    isControllable(entity) ?
                      React.createElement('button', {
                        onClick: () => toggleEntity(entity.entity_id, entity.state),
                        className: `w-full py-3 rounded-xl font-semibold transition-all ${
                          entity.state === 'on'
                            ? 'bg-[#f5f5dc] hover:bg-[#e5e5cc] text-[#1a4d4d] shadow-lg'
                            : 'bg-[#1a4d4d]/80 hover:bg-[#1a4d4d] text-[#f5f5dc]/70 border border-[#f5f5dc]/20'
                        }`
                      }, entity.state === 'on' ? 'ENCENDIDO' : 'APAGADO')
                    : React.createElement('div', {
                        className: 'w-full py-3 px-4 rounded-xl text-center font-semibold bg-[#1a4d4d]/80 text-[#f5f5dc]/70 border border-[#f5f5dc]/20'
                      }, `${entity.state} ${entity.attributes.unit_of_measurement || ''}`)
                  )
                )
              )
            )
          )
        )
      );
    }

    const root = createRoot(document.getElementById('app'));
    root.render(React.createElement(DotikaApp));
  </script>

</body>
</html>
